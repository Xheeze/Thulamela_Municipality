const r={DOCUMENTS:"digiserve:documents",APPOINTMENTS:"digiserve:appointments",PROFILE:"digiserve:profile",FEEDBACK:"digiserve:feedback",QUEUE:"digiserve:queue",TASKS:"digiserve:tasks"};function c(t,e=[]){try{const n=localStorage.getItem(t);return n?JSON.parse(n):e}catch(n){return console.error("storage read error",n),e}}function u(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(n){console.error("storage write error",n)}}function S(t=""){return t+Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,9)}function l(){return c(r.DOCUMENTS,[])}function T({name:t,size:e,type:n,dataUrl:o=null,meta:i={}}){const s=l(),a={id:S("doc_"),name:t,size:e,type:n,dataUrl:o,meta:i,status:"submitted",createdAt:new Date().toISOString()};return s.unshift(a),u(r.DOCUMENTS,s),a}function O(t,e){const n=l(),o=n.findIndex(i=>i.id===t);return o===-1?null:(n[o]={...n[o],...e},u(r.DOCUMENTS,n),n[o])}function A(){return c(r.APPOINTMENTS,[])}function m({service:t,date:e,time:n,name:o,contact:i}){const s=A();if(s.find(g=>g.service===t&&g.date===e&&g.time===n))throw new Error("Slot already booked");const d={id:S("appt_"),service:t,date:e,time:n,name:o,contact:i,status:"scheduled",createdAt:new Date().toISOString()};return s.push(d),u(r.APPOINTMENTS,s),d}function x(t){let e=A();e=e.map(n=>n.id===t?{...n,status:"cancelled"}:n),u(r.APPOINTMENTS,e)}function D(){return c(r.PROFILE,null)}function I(t){return u(r.PROFILE,t),t}function p(){return c(r.FEEDBACK,[])}function w({category:t,message:e,name:n,contact:o}){const i=p(),s={id:S("fb_"),category:t,message:e,name:n,contact:o,createdAt:new Date().toISOString()};return i.unshift(s),u(r.FEEDBACK,i),s}function N(){return c(r.QUEUE,{nowServing:"A092",next:["A093","A094","A095"],counter:"Counter 3"})}function E(){return c(r.QUEUE,{nowServing:"A092",next:["A093","A094","A095"],counter:"Counter 3"})}function v(){const t=E();if(!t.next||t.next.length===0)return t;const e=t.next.shift();return t.nowServing=e,u(r.QUEUE,t),t}function U(t){const e=E();return e.next=e.next||[],e.next.push(t),u(r.QUEUE,e),e}function f(){return c(r.TASKS,[])}function k({title:t,description:e,assignedTo:n,priority:o,dueDate:i,category:s}){const a=f(),d={id:S("task_"),title:t,description:e,assignedTo:n,priority:o||"medium",dueDate:i,category:s||"general",status:"open",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return a.unshift(d),u(r.TASKS,a),d}function P(t,e){const n=f(),o=n.findIndex(i=>i.id===t);return o===-1?null:(n[o]={...n[o],...e,updatedAt:new Date().toISOString()},u(r.TASKS,n),n[o])}function h(t){let e=f();return e=e.filter(n=>n.id!==t),u(r.TASKS,e),!0}const C={getDocuments:l,saveDocument:T,updateDocument:O,getAppointments:A,saveAppointment:m,cancelAppointment:x,getProfile:D,saveProfile:I,getFeedback:p,saveFeedback:w,getQueue:N,getQueueState:E,callNext:v,addToQueue:U,getTasks:f,saveTask:k,updateTask:P,deleteTask:h};export{C as s};
